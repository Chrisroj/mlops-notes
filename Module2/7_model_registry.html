<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Model Registry - test-book</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "rust" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../Module1/1_intro.html"><strong aria-hidden="true">1.</strong> Introduction to MLOps</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Module1/2_aws.html"><strong aria-hidden="true">1.1.</strong> VM Instance in AWS</a></li><li class="chapter-item expanded "><a href="../Module1/3_dependencies.html"><strong aria-hidden="true">1.2.</strong> Install Dependencies</a></li><li class="chapter-item expanded "><a href="../Module1/4_overview.html"><strong aria-hidden="true">1.3.</strong> Course Overview</a></li><li class="chapter-item expanded "><a href="../Module1/5_maturity.html"><strong aria-hidden="true">1.4.</strong> MLOps Maturity Model</a></li></ol></li><li class="chapter-item expanded "><a href="../Module2/1_intro_exptracking.html"><strong aria-hidden="true">2.</strong> Introduction to Experiment tracking</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Module2/2_start_mlflow.html"><strong aria-hidden="true">2.1.</strong> Getting Started with MLflow</a></li><li class="chapter-item expanded "><a href="../Module2/3_track_single.html"><strong aria-hidden="true">2.2.</strong> Tracking a Single Experiment</a></li><li class="chapter-item expanded "><a href="../Module2/4_track_hyper.html"><strong aria-hidden="true">2.3.</strong> Tracking a Multiples Experiments</a></li><li class="chapter-item expanded "><a href="../Module2/5_autologging.html"><strong aria-hidden="true">2.4.</strong> Autologging</a></li><li class="chapter-item expanded "><a href="../Module2/6_log_models.html"><strong aria-hidden="true">2.5.</strong> Log Models</a></li><li class="chapter-item expanded "><a href="../Module2/7_model_registry.html" class="active"><strong aria-hidden="true">2.6.</strong> Model Registry</a></li><li class="chapter-item expanded "><a href="../Module2/8_mlflow_benefits.html"><strong aria-hidden="true">2.7.</strong> MLflow: Benefits, Limitations and Alternatives</a></li></ol></li><li class="chapter-item expanded "><a href="../Appendixes/A_gcp.html"><strong aria-hidden="true">3.</strong> Appendix A: VM Instance in GCP</a></li><li class="chapter-item expanded "><a href="../Appendixes/B_conda.html"><strong aria-hidden="true">4.</strong> Appendix B: Conda Environments</a></li><li class="chapter-item expanded "><a href="../Appendixes/C_mlflow_aws.html"><strong aria-hidden="true">5.</strong> Appendix C: MLflow on AWS</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">test-book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="model-registry"><a class="header" href="#model-registry">Model Registry</a></h1>
<p>The Data Scientist decides what models in the tracking server are ready to production and then can register those models into the mlflow registry in that way the Deployment Engineer can take a look in the model registry and see whats models are ready for production. In that way the communication between the person that is in charge of building the model and the person is in charge of deploying the model is improved.</p>
<p><img src="../Images/Module2/mlflow_registry.PNG" alt="conda_logo" /></p>
<p>Model Registry only lists models that are production-ready(don't perform the deployment <em>perse</em>) and the stages are just labels assigned to the model. To deploy the model, we will require to implement CI/CD code to communicate with Model Registry.</p>
<p><strong>Note:</strong> To use the Model Registry you need to specify a backend store.</p>
<h2 id="model-registry-using-ui"><a class="header" href="#model-registry-using-ui">Model Registry using UI</a></h2>
<p><strong>Storing Models in the Registry</strong></p>
<p>In order to register models using the UI, we select the run whose model we want to register and then select &quot;Register Model&quot;. There we may either create a new model registry or register the model into an existing registry. We can view the registry and the models there in by selecting the &quot;Models&quot; tab in the top and selecting the registry we want.</p>
<p><img src="../Images/Module2/mlflow_modelstab.png" alt="conda_logo" /></p>
<p><strong>Promoting and Demoting Models in the registry</strong></p>
<p>Models in the registry are labeled either as Staging, Production or Archive. Promoting and demoting a model can be done by selecting the model in the registry and selecting the stage of the model in the drop down &quot;Stage&quot; Menu at the top.</p>
<p><img src="../Images/Module2/mlflow_modelstage.png" alt="conda_logo" /></p>
<h2 id="model-registry-using-tracking-client"><a class="header" href="#model-registry-using-tracking-client">Model Registry using Tracking Client</a></h2>
<p><strong>Create MLflow Client Instance</strong></p>
<p>In order to automate the process of registering/promoting/demoting models, we use the Tracking Client API initialized as described above:</p>
<pre><code class="language-python">from mlflow.tracking import MlflowClient

MLFLOW_TRACKING_URI = &quot;sqlite:///mlflow.db&quot;

client = MlflowClient(tracking_uri=MLFLOW_TRACKING_URI)
</code></pre>
<p><strong>Get List of Experiments</strong></p>
<p>You can get a list of the experiments with its <code>artifact_location</code>, <code>experiment_id</code>, <code>tags</code>, etc. Typing:</p>
<pre><code class="language-python">client.list_experiments()
</code></pre>
<p><strong>Note:</strong> Every time you start using mlflow there will be a default experiment <code>name = Default</code>.</p>
<p><strong>Create and Experimment</strong></p>
<pre><code class="language-python">client.create_experiment(name = EXPERIMENT_NAME)
</code></pre>
<p><strong>Searching Runs</strong></p>
<p>We can search for runs by ascending order of metric score using the API following the next example:</p>
<pre><code class="language-python">from mlflow.entities import ViewType

runs = client.search_runs(
    experiment_ids = '1',    # Experiment ID we want
    filter_string = &quot;metrics.rmse &lt; 7&quot;,
    run_view_type = ViewType.ACTIVE_ONLY,
    max_results = 5,
    order_by = [&quot;metrics.rmse ASC&quot;]
)
</code></pre>
<ul>
<li><code>search_runs</code> is a simplified version of SQL <code>WHERE</code> clause.</li>
<li>We first need to specify which experiment id that we are referring to (<code>nyc_taxi_experiment</code>'s id is 1).</li>
<li>The <code>filter_string</code> allows us to filter the runs you can set empty <code>&quot;&quot;</code>.</li>
<li>The <code>run_view_type</code> value <code>ViewType.ACTIVE_ONLY</code> shows only the active runs (and not deleted runs)</li>
<li><code>max_results</code> showing only 5 results</li>
<li><code>order_by</code> - ordering the results by <code>metrics.rmse</code> and <code>ASC</code> ascending (like SQL)</li>
</ul>
<p>Now we can then get information about the selected runs from the resulting <code>runs</code> enumerator:</p>
<pre><code class="language-python">for run in runs:
    print(f&quot;run id: {run.info.run_id}, rmse: {run.data.metrics['rmse']:.4f}&quot;)
</code></pre>
<p><strong>Add a run model to a registry</strong></p>
<pre><code class="language-python">mlflow.set_tracking_uri(MLFLOW_TRACKING_URI)

run_id = &quot;9245396b47c94513bbf9a119b100aa47&quot;
model_uri = f&quot;runs:/{run_id}/models&quot;
mlflow.register_model(model_uri=model_uri, name=&quot;nyc-taxi-regressor&quot;)
</code></pre>
<p><strong>Get the models in a model registry</strong></p>
<pre><code class="language-python">model_name = &quot;nyc-taxi-regressor&quot;
latest_versions = client.get_latest_versions(name=model_name)

for version in latest_versions:
    print(f&quot;version: {version.version}, stage: {version.current_stage}&quot;)
</code></pre>
<p><strong>Promote a model to staging</strong></p>
<pre><code class="language-python">model_version = 4
new_stage = &quot;Staging&quot;
client.transition_model_version_stage(
    name=model_name,
    version=model_version,
    stage=new_stage,
    archive_existing_versions=False
)
</code></pre>
<p><strong>Update the description of a model</strong></p>
<pre><code class="language-python">from datetime import datetime

date = datetime.today().date()
client.update_model_version(
    name=model_name,
    version=model_version,
    description=f&quot;The model version {model_version} was transitioned to {new_stage} on {date}&quot;
)
</code></pre>
<p>These can then be used to automate the promotion of packages into production or the archival of older models.</p>
<p><strong>Download Artifacts</strong></p>
<p>You can download the artifacts in <code>path</code> belong to the <code>run_id</code> and will be downloaded in <code>dst_path</code></p>
<pre><code class="language-python">run_id = &quot;9245396b47c94513bbf9a119b100aa47&quot;
client.download_artifacts(run_id = run_id, path = &quot;extra_artifacts&quot;, dst_path = &quot;.&quot;)
</code></pre>
<p>And now you can load the files that were located in the artifacts:</p>
<pre><code class="language-python">import pickled

with open(&quot;vectorizer.pkl&quot;, &quot;rb&quot;) as f_in:
    dv = pickle.load(f_in)
</code></pre>
<p>If you want to know more about MLflow in practice you can check <a href="https://www.youtube.com/watch?v=1ykg4YmbFVA&amp;list=PL3MmuxUbc_hIUISrluw_A7wDSmfOhErJK">MLflow in practice</a>, if you do that for the scenario 3 you'll need <a href="../Appendixes/C_mlflow_aws.html">MLflow on AWS notes</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Module2/6_log_models.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../Module2/8_mlflow_benefits.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Module2/6_log_models.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../Module2/8_mlflow_benefits.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
